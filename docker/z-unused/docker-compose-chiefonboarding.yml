---
version: '3'

services:
  db:
    image: postgres:latest
    restart: always
    expose:
    - '5432'
    volumes:
    - pgdata:/var/lib/postgresql/data/
    environment:
    - POSTGRES_DB=chiefonboarding
    - POSTGRES_USER=postgres
    - POSTGRES_PASSWORD=postgres
    networks:
    - chiefonboarding

  web:
    image: chiefonboarding/chiefonboarding:latest
    restart: always
    # expose:
    #   - "8000"
    ports:
    - 8000:8000     # when use without caddy
    environment:
    - SECRET_KEY=somethingsupersecret
    - BASE_URL=https://onboarding.karnwong.me
    - DATABASE_URL=postgres://postgres:postgres@db:5432/chiefonboarding
    - ALLOWED_HOSTS=onboarding.karnwong.me
    - DEFAULT_FROM_EMAIL=hello@chiefonboarding.com
      # - HTTP_INSECURE=True # when use without caddy
    depends_on:
    - db
    networks:
    - chiefonboarding

  # caddy:
  #   image: caddy:2.3.0-alpine
  #   restart: unless-stopped
  #   ports:
  #     - "80:80"
  #     - "443:443"
  #   volumes:
  #     - $PWD/Caddyfile:/etc/caddy/Caddyfile
  #     - $PWD/site:/srv
  #     - caddy_data:/data
  #     - caddy_config:/config
  #   networks:
  #     - chiefonboarding

volumes:
  pgdata:
  # caddy_data:
  # caddy_config:

networks:
  chiefonboarding:
